##### 外网映射工具
微信开发、第三方支付的时候。微信事件通知、第三方支付回调通知，如果想在本地开发的话，根本就是无法测试。    
使用第三方外网映射工具，将本地服务映射到外网。主流的工具(natapp ngrok:完全免费)     
外网映射工具：natapp(可免费注册) 基于ngrok实现: 让外网更够访问本地      
插件工具包含网络穿透uTools,项目比较大可以使用付费的Natapp        
##### Nginx的特点(俄罗斯人开发,并发服务器)
1、nginx是一款轻量级的方向代理服务器     
2、nginx可以做服务器,比tomcat资源耗能更低,支持更多的并发连接,更高的效率     
##### Nginx的应用场景(解决方案和应用场景是不一样的)
- 核心功能              
1、Http服务器(使用Nginx做静态服务器、图片服务器)         
2、虚拟主机配置(将一台服务器,拆分多个网站进行部署)        
3、反向代理 使用反向代理隐藏真实ip访问地址    
4、负载均衡(集群):减少单台服务器压力故障转移(重试机制-不建议使用会产生幂等问题、健康检查(tcp、http心跳检测))     
5、安全配置     
- 非核心       
6、使用Nginx搭建API接口网关(网关的目的是对请求的权限安全去进行控制),解决网站跨域        
7、使用Nginx实现网站动静分离      
8、使用Nginx实现防止DDOS(安全控制)--[DDOS频繁访问网站,占用网站宽带,流量攻击]         
9、使用Nginx配置缓存(Http)  
windows版本nginx与linux版本nginx本质上配置没有很大区别
##### Nginx windows 版本启动问题
双击启动nginx.exe文件,一闪而过时,去查看下logs文件夹里面的error.log如果没有错误说明启动成功,也可以通过控制管理器查看nginx进程是否存在    
nginx 默认 启动监听的端口号 80      
Nginx 启动产生端口号80,内部是http服务器   
windows版本启动方式,cmd进入nginx所在目录然后输入:          
1、启动：start nginx 这种方式可以避免杀进程的情况出现      
2、关闭: nginx -s stop
##### Nginx实现虚拟主机配置(原理)
一、基于域名的虚拟主机配置       
假设bbs.amazecode.com和www.amazecode.com最终都在同一台服务器上运行,端口号都是80,这时就可以使用nginx基于域名区分项目(通过文件夹实现)         
配置步骤：(原理图可参考：Nginx配置虚拟主机(基于域名区分项目).png)           
1、配置host文件
```text
127.0.0.1 www.amazecode.com
127.0.0.1 bbs.amazecode.com
```
2、配置nginx配置文件
具体配置参考：nginx-配置虚拟主机(即根据域名跳转目录).conf  
启动nginx后,测试方式直接访问域名
```text
www.amazecode.com     -- 访问的是 www目录
bbs.amazecode.com     -- 访问的是 bbs目录
```   
二、基于端口号的虚拟主机配置
假设域名相同，监听的端口号不一样,比如监听8080,8081,访问时通过域名添加端口号访问          
具体配置参考: nginx-配置虚拟主机(即根据端口号跳转目录).conf     
启动nginx后,测试方式直接访问域名:端口号
```text
www.amazecode.com:8080     -- 访问的是 www目录
bbs.amazecode.com:8081     -- 访问的是 bbs目录
```   
##### 反向代理
1、基于Nginx实现的反向代理(原理参考:Nginx反向代理图.png)        
2、什么是反向代理
```java
nginx拦截所有的请求,内部实现转发到真实服务器地址中
```  
3、反向代理作用   
```java
提高安全性,反向代理主要是隐藏真实ip
抓包工具能不能抓取到nginx代理的节点信息？答案:抓取不到nginx转发的请求比较安全(可以使用Fiddle抓包工具测试)
```
###### 反向代理-根据域名区分服务器的反向代理配置
演示需要配置host
```java
127.0.0.1 www.amazecode.com
127.0.0.1 bbs.amazecode.com
```
本地启动两个项目,端口号分别为8080,8081,分别访问连接都是根路径/,修改好nginx反向代理配置的配置文件后,启动nginx,
通过访问域名进行测试    
```text
www.amazecode.com   -- proxy_pass http://127.0.0.1:8080
bbs.amazecode.com   -- proxy_pass http://127.0.0.1:8081
```    
具体配置可参考:nginx-反向代理(根据域名,隐藏真实ip).conf
###### 反向代理-同域名根据项目名称-location规则配置
```java
127.0.0.1 www.amazecode.com
```
根据项目名称区分代理服务器(同一个server,多个location)  
```text
www.amazecode.com/tomcat8080   -- proxy_pass http://127.0.0.1:8080
www.amazecode.com/tomcat8081   -- proxy_pass http://127.0.0.1:8081
```    
具体配置参考:nginx-反向代理(同域名根据项目名称-location配置).conf
页面访问测试
```text
www.amazecode.com/tomcat8080   跳转到  http://127.0.0.1:8080对应的应用
www.amazecode.com/tomcat8081   跳转到  http://127.0.0.1:8081对应的应用
```
原理参考:反向代理-根据项目名称区分.png          
###### 根据域名区分的反向代理在大型互联网项目此种方式配置叫做API设计
网关作用:拦截请求、请求配置、反向代理          
在nginx和网关一起使用的时候,两者的功能区分:        
1、nginx主要做反向代理功能    
2、网关作用权限控制(互联网安全架构设计,黑名单设计、白名单设计)     
原理参考:API网关设计.png
##### 反向代理-location语法(参考:反向代理-location语法.png)
```text
1、以=开头表示精确匹配,如果匹配根目录(/)结尾的请求,后面不能带任何字符串
2、以^~开头表示uri以某个常规字符串开头,不是正则匹配
3、以~开头表示区分大小写的正则匹配
4、~*开头表示不区分大小写的正则匹配
5、/通用匹配,如果没有其他匹配,任何请求都会匹配到
```
##### 负载均衡
1、什么是负载均衡？  
```text
四层负载均衡器(Nginx)：基于传输层,也叫做基于TCP协议实现负载均衡,LVS软负载和F5硬件负载，在nginx1.9之后支持对四层负载均衡（TCP\UDP层）
七层负载均衡器(Nginx): 基于应用层也叫做基于HTTP协议实现负载均衡,即Web服务器实现负载均衡,在nginx1.9之前只支持七层负载均衡
思考问题:nginx什么版本支持四层负载均衡?nginx在1.9版本之前是不支持四层负载均衡,只能支持http,1.9之后开始支持四层负载均衡
```   
```text
四层负载均衡和七层负载均衡的区别?
四层负载均衡器: 主要在传输层实现负载均衡 ### 主要针对TCP协议
七层负载均衡器：主要在应用层实现负载均衡 ### 主要针对HTTP协议
```  
```text
负载均衡作用:目的是解决高并发,将所有请求转发到负载均衡器,再有负载均衡器采用负载均衡算法进行负载均衡
负载均衡算法(共5中):轮询机制、权重、IP绑定(这三种比较常用)
```
2、为什么要用负载均衡?                   
3、负载均衡给我们带来的问题?         
4、负载均衡算法      


